<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>3.1 Multi-Step Total ‚Äì 400 ‚àí (100 + 160)</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --panel:#f9fafb;
      --ok:#065f46;
      --warn:#92400e;
      --bad:#991b1b;
      --btn:#111827;
      --btnText:#ffffff;
      --chip:#eef2ff;
      --soft:#f3f4f6;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:var(--bg);
    }
    .wrap{max-width:920px;margin:0 auto;padding:22px}
    header{display:flex;justify-content:space-between;gap:16px;align-items:flex-start;flex-wrap:wrap}
    h1{font-size:20px;margin:0 0 6px 0}
    .sub{color:var(--muted);font-size:13px;margin:0}
    .pill{
      background:var(--chip);
      border:1px solid #dbeafe;
      color:#1f2937;
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      display:inline-flex;
      gap:8px;
      align-items:center;
    }
    .card{
      border:1px solid var(--line);
      border-radius:14px;
      padding:16px;
      background:#fff;
      box-shadow: 0 1px 0 rgba(0,0,0,.02);
    }
    .grid{display:grid;gap:14px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media (max-width:800px){ .grid2{grid-template-columns:1fr} }

    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    input[type="text"], textarea, select{
      width:100%;
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px 12px;
      font-size:16px;
      outline:none;
      background:#fff;
    }
    input[type="text"]:focus, textarea:focus, select:focus{
      border-color:#c7d2fe;
      box-shadow:0 0 0 3px rgba(99,102,241,.12)
    }
    textarea{min-height:120px; resize:vertical;}

    .bigProblem{
      font-size:16px;
      font-weight:650;
      line-height:1.35;
      padding:12px 12px;
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:14px;
      white-space:pre-wrap;
    }

    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{
      border:1px solid var(--btn);
      background:var(--btn);
      color:var(--btnText);
      padding:10px 12px;
      border-radius:12px;
      font-size:14px;
      cursor:pointer;
      user-select:none;
    }
    .btn.secondary{
      background:#fff;
      color:var(--text);
      border:1px solid var(--line);
    }
    .btn:active{transform:translateY(1px)}
    .toggle{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:6px;}
    .toggle input{transform:scale(1.1)}

    .strategyTitle{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      border-bottom:1px solid var(--line);
      padding-bottom:10px;
      margin-bottom:12px;
    }
    .strategyTitle b{font-size:16px}
    .example{color:var(--muted);font-size:13px}

    .step{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:14px;
      padding:14px;
    }
    .stepHead{
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      align-items:baseline;
      margin-bottom:10px;
    }
    .stepNum{font-weight:800}
    .hintTag{color:var(--muted);font-size:12px}

    .mini{font-size:12px;color:var(--muted)}
    .muted{color:var(--muted)}
    .divider{height:1px;background:var(--line);margin:12px 0}

    .feedback{
      margin-top:10px;
      font-size:13px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
    }
    .feedback.ok{border-color:rgba(6,95,70,.25); color:var(--ok)}
    .feedback.warn{border-color:rgba(146,64,14,.25); color:var(--warn)}
    .feedback.bad{border-color:rgba(153,27,27,.25); color:var(--bad)}
    .reveal{
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      border:1px dashed #c7d2fe;
      background:#fff;
      font-size:13px;
    }

    .choiceRow{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;}
    .choice{
      border:1px solid var(--line);
      background:#fff;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-size:14px;
      text-align:left;
    }
    .choice:hover{border-color:#c7d2fe}

    .qa{
      border:1px solid var(--line);
      background:#fff;
      border-radius:14px;
      padding:12px;
      margin-top:10px;
    }
    .qa b{font-size:13px}
    .snippet{
      margin-top:6px;
      font-size:13px;
      color:var(--muted);
      padding:8px 10px;
      border-radius:12px;
      border:1px dashed #e5e7eb;
      background:#fff;
    }

    pre{
      margin:0;
      white-space:pre-wrap;
      word-break:break-word;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:13px;
    }

    /* =========================
       ADD-ON: regulation + reflection + teacher + print
       ========================= */
    .sectionTitle{
      font-weight:700;
      font-size:14px;
      margin:0 0 10px 0;
    }
    .regWrap{
      border:1px solid var(--line);
      border-radius:14px;
      padding:14px;
      background:var(--panel);
    }
    .regGrid{
      display:grid;
      grid-template-columns:1.05fr 0.95fr;
      gap:14px;
      align-items:flex-start;
    }
    @media (max-width:800px){
      .regGrid{grid-template-columns:1fr;}
    }
    .regBox{
      border-radius:12px;
      border:1px solid var(--line);
      padding:10px 12px;
      background:#fff;
      margin-bottom:12px;
    }
    .regHead{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:10px;
      margin-bottom:10px;
    }
    .regHead b{font-size:13px}
    .regHead span{font-size:12px;color:var(--muted)}

    .moodMeter{
      display:grid;
      grid-template-columns:28px 1fr;
      gap:10px;
      align-items:start;
    }
    .moodLevels{
      display:grid;
      grid-template-rows:repeat(5,1fr);
      gap:6px;
    }
    .lvl{
      font-size:12px;
      color:var(--muted);
      display:flex;
      align-items:center;
      justify-content:center;
      border:1px solid var(--line);
      border-radius:10px;
      padding:6px 0;
      background:#fff;
      user-select:none;
    }
    .moodGrid{
      display:grid;
      grid-template-columns:repeat(5,1fr);
      grid-template-rows:repeat(5,1fr);
      gap:6px;
    }
    .cell{
      border-radius:10px;
      height:32px;
      border:1px solid rgba(0,0,0,.04);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:12px;
      color:rgba(17,24,39,.7);
    }
    .cell:hover{outline:2px solid rgba(99,102,241,.18)}
    .cell.selected{
      outline:3px solid rgba(17,24,39,.85);
      border-color:rgba(17,24,39,.18);
    }
    .faces{
      display:flex;
      gap:8px;
      margin-top:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .faceBtn{
      border:1px solid var(--line);
      background:#fff;
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      font-size:16px;
      line-height:1;
      display:flex;
      gap:8px;
      align-items:center;
    }
    .faceBtn small{font-size:12px;color:var(--muted)}
    .faceBtn.selected{
      border-color:#111827;
      box-shadow:0 0 0 3px rgba(17,24,39,.08);
    }
    .needsGrid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:8px;
    }
    @media (max-width:640px){
      .needsGrid{grid-template-columns:1fr;}
    }
    .needBtn{
      border:1px solid var(--line);
      background:#fff;
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      text-align:left;
      display:flex;
      gap:10px;
      align-items:center;
      min-height:54px;
      font-size:13px;
    }
    .needBtn:hover{border-color:#c7d2fe}
    .needBtn.selected{
      border-color:#111827;
      box-shadow:0 0 0 3px rgba(17,24,39,.08);
    }
    .needIcon{
      width:36px;
      height:36px;
      border-radius:12px;
      background:var(--soft);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:18px;
      flex:0 0 auto;
    }
    .needText b{display:block;font-size:13px}
    .needText span{display:block;font-size:12px;color:var(--muted);margin-top:2px}
    .tinyHelp{font-size:12px;color:var(--muted);margin-top:8px}
    .moodLegend{
      display:flex;
      justify-content:space-between;
      font-size:12px;
      color:var(--muted);
      margin-top:8px;
    }
    .printOnly{display:none;}

    @media print{
      body{background:#fff}
      .wrap{max-width:none;padding:0}
      header,.pill,.toggle,
      #useProblemBtn,#resetBtn,#copyBtn,#summaryBtn,
      #check1,#check2,#check3,#check4,#check5,
      #show1,#show2,#show3,#show4,#show5,
      #copyNote,#parseNote,
      #reportBtn,#printBtn{
        display:none !important;
      }
      .card{box-shadow:none;border:none;}
      .printOnly{display:block;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Lesson 3-1</h1>
        <p class="sub">3.1 Multi-Step Total ‚Äì Example: <b>400 ‚àí (100 + 160)</b></p>
      </div>
      <div class="pill">
        <span>Multi-Step</span>
        <span class="muted">‚Ä¢</span>
        <span class="muted">Total ‚àí Parts</span>
      </div>
    </header>

    <div class="grid" style="margin-top:14px;">
      <!-- Problem input -->
      <div class="card">
        <label for="problemInput">Type or paste the word problem (or type: 400, 100, 160)</label>
        <div class="grid2">
          <textarea id="problemInput" placeholder="Paste the story here..."></textarea>
          <button class="btn" id="useProblemBtn">Use this problem</button>
        </div>

        <div class="toggle">
          <label style="margin:0;color:var(--muted);font-size:13px;">
            <input type="checkbox" id="lowMode" />
            CHILL MODE (show 2 obvious options)
          </label>
        </div>

        <div class="divider"></div>

        <label class="mini">Big problem</label>
        <div class="bigProblem" id="bigProblem">‚Äî</div>
        <p class="mini" id="parseNote" style="margin-top:10px;"></p>
      </div>

      <!-- Strategy + steps -->
      <div class="card">
        <div class="strategyTitle">
          <div>
            <b>We are using: Find the Missing Amount (Total Problem)</b>
            <div class="example" id="exampleLabel">Example: 400 ‚àí (100 + 160) = 140</div>
          </div>
          <button class="btn secondary" id="resetBtn">Reset steps</button>
        </div>

        <div class="grid">
          <!-- Step 1 -->
          <div class="step" id="step1">
            <div class="stepHead">
              <div><span class="stepNum">STEP 1</span> ‚Äî Find the total goal</div>
              <div class="hintTag" id="hint1">Hints used: 0</div>
            </div>

            <div class="qa">
              <b>What is the total goal?</b>
              <div class="snippet" id="snipTotal">trying to raise $400</div>

              <label for="s1" style="margin-top:8px;">Total goal</label>
              <input id="s1" type="text" placeholder="ex: 400" />
              <div class="choiceRow" id="s1Choices" style="display:none;"></div>
            </div>

            <div class="row" style="margin-top:10px;">
              <button class="btn secondary" id="check1">Check my step</button>
              <button class="btn" id="show1">Show answer</button>
            </div>
            <div id="fb1"></div>
            <div id="rev1"></div>
          </div>

          <!-- Step 2 -->
          <div class="step" id="step2">
            <div class="stepHead">
              <div><span class="stepNum">STEP 2</span> ‚Äî Add what is already raised</div>
              <div class="hintTag" id="hint2">Hints used: 0</div>
            </div>

            <div class="qa">
              <b>What amounts are already raised?</b>
              <div class="snippet" id="snipParts">Mark raised $100. Jesse raised $160.</div>

              <div class="grid2" style="margin-top:10px;">
                <div>
                  <label for="s2a">Part 1</label>
                  <input id="s2a" type="text" placeholder="ex: 100" />
                </div>
                <div>
                  <label for="s2b">Part 2</label>
                  <input id="s2b" type="text" placeholder="ex: 160" />
                </div>
              </div>

              <label for="s2sum" style="margin-top:10px;">Sum of known parts</label>
              <input id="s2sum" type="text" placeholder="ex: 260" />

              <div class="choiceRow" id="s2Choices" style="display:none;"></div>
            </div>

            <div class="row" style="margin-top:10px;">
              <button class="btn secondary" id="check2">Check my step</button>
              <button class="btn" id="show2">Show answer</button>
            </div>
            <div id="fb2"></div>
            <div id="rev2"></div>
          </div>

          <!-- Step 3 -->
          <div class="step" id="step3">
            <div class="stepHead">
              <div><span class="stepNum">STEP 3</span> ‚Äî Write the equation</div>
              <div class="hintTag" id="hint3">Hints used: 0</div>
            </div>

            <div class="muted" style="font-size:13px;">
              Let <b>m</b> be the amount Devon needs to raise.
              <span class="mini" style="display:block;margin-top:6px;">Total = part + part + missing.</span>
            </div>

            <label for="s3" style="margin-top:10px;">Equation for m</label>
            <input id="s3" type="text" placeholder="ex: 100 + 160 + m = 400" />

            <div class="choiceRow" id="s3Choices" style="display:none;"></div>

            <div class="row" style="margin-top:10px;">
              <button class="btn secondary" id="check3">Check my step</button>
              <button class="btn" id="show3">Show answer</button>
            </div>
            <div id="fb3"></div>
            <div id="rev3"></div>
          </div>

          <!-- Step 4 -->
          <div class="step" id="step4">
            <div class="stepHead">
              <div><span class="stepNum">STEP 4</span> ‚Äî Solve for the missing amount</div>
              <div class="hintTag" id="hint4">Hints used: 0</div>
            </div>

            <div class="muted" style="font-size:13px;">
              Missing = Total ‚àí (known parts).
              <b><span id="solveLabel">‚Äî</span></b>
            </div>

            <label for="s4" style="margin-top:10px;">m</label>
            <input id="s4" type="text" placeholder="ex: 140" />

            <div class="choiceRow" id="s4Choices" style="display:none;"></div>

            <div class="row" style="margin-top:10px;">
              <button class="btn secondary" id="check4">Check my step</button>
              <button class="btn" id="show4">Show answer</button>
            </div>
            <div id="fb4"></div>
            <div id="rev4"></div>
          </div>

          <!-- Step 5 -->
          <div class="step" id="step5">
            <div class="stepHead">
              <div><span class="stepNum">STEP 5</span> ‚Äî Label the answer</div>
              <div class="hintTag" id="hint5">Hints used: 0</div>
            </div>

            <div class="muted" style="font-size:13px;">
              Write a sentence with dollars.
            </div>

            <label for="s5" style="margin-top:10px;">Sentence</label>
            <input id="s5" type="text" placeholder="Devon needs to raise $____ to reach the goal." />

            <div class="choiceRow" id="s5Choices" style="display:none;"></div>

            <div class="row" style="margin-top:10px;">
              <button class="btn secondary" id="check5">Check my step</button>
              <button class="btn" id="show5">Show answer</button>
            </div>
            <div id="fb5"></div>
            <div id="rev5"></div>
          </div>

          <!-- Summary -->
          <div class="card" style="background:#fff;">
            <div class="row">
              <button class="btn" id="summaryBtn">Show my summary</button>
              <button class="btn secondary" id="copyBtn">Copy summary</button>
              <span class="mini" id="copyNote"></span>
            </div>

            <div class="reveal" style="margin-top:12px;">
              <pre id="summaryOut">Summary will appear here.</pre>
            </div>
          </div>

          <!-- Reflection + regulation + report -->
          <div class="card" id="reflectionCard">
            <p class="sectionTitle">Quick Check-In + Report</p>
            <div class="regWrap">
              <div class="regGrid">
                <!-- Left column -->
                <div>
                  <div class="regBox">
                    <div class="regHead">
                      <b>What am I feeling?</b>
                      <span>Tap a square + a face (optional)</span>
                    </div>
                    <div class="moodMeter">
                      <div class="moodLevels" aria-hidden="true">
                        <div class="lvl">5</div><div class="lvl">4</div><div class="lvl">3</div><div class="lvl">2</div><div class="lvl">1</div>
                      </div>
                      <div>
                        <div class="moodGrid" id="moodGrid" role="grid" aria-label="Feeling intensity grid"></div>
                        <div class="faces" role="group" aria-label="Mood faces">
                          <button class="faceBtn" type="button" data-face="üò£"><span>üò£</span><small>rough</small></button>
                          <button class="faceBtn" type="button" data-face="üòï"><span>üòï</span><small>iffy</small></button>
                          <button class="faceBtn" type="button" data-face="üòê"><span>üòê</span><small>okay</small></button>
                          <button class="faceBtn" type="button" data-face="üôÇ"><span>üôÇ</span><small>good</small></button>
                          <button class="faceBtn" type="button" data-face="üòÑ"><span>üòÑ</span><small>great</small></button>
                        </div>
                        <div class="tinyHelp" id="moodReadout">Selected: ‚Äî</div>
                      </div>
                    </div>
                    <div class="moodLegend"><span>üòû harder</span><span>üôÇ better</span></div>
                    <div class="moodLegend" style="margin-top:-6px;"><span>low energy</span><span>high energy</span></div>
                  </div>

                  <div class="regBox">
                    <div class="regHead">
                      <b>What is my need?</b>
                      <span>Tap one (or none)</span>
                    </div>
                    <div class="needsGrid" role="group" aria-label="Needs">
                      <button class="needBtn" type="button" data-need="Plan"><div class="needIcon">üó∫</div><div class="needText"><b>Plan</b><span>clarity</span></div></button>
                      <button class="needBtn" type="button" data-need="Quiet"><div class="needIcon">üëÇ</div><div class="needText"><b>Quiet</b><span>listen</span></div></button>
                      <button class="needBtn" type="button" data-need="Break"><div class="needIcon">üßò</div><div class="needText"><b>Break</b><span>rest</span></div></button>
                      <button class="needBtn" type="button" data-need="Help"><div class="needIcon">ü§ù</div><div class="needText"><b>Help</b><span>support</span></div></button>
                      <button class="needBtn" type="button" data-need="Food"><div class="needIcon">üçΩ</div><div class="needText"><b>Food</b><span>fuel</span></div></button>
                      <button class="needBtn" type="button" data-need="Move"><div class="needIcon">üèÉ</div><div class="needText"><b>Move</b><span>body</span></div></button>
                      <button class="needBtn" type="button" data-need="Water"><div class="needIcon">üíß</div><div class="needText"><b>Water</b><span>drink</span></div></button>
                      <button class="needBtn" type="button" data-need="Health"><div class="needIcon">‚ù§Ô∏è</div><div class="needText"><b>Health</b><span>check-in</span></div></button>
                    </div>
                    <div class="tinyHelp" id="needReadout">Selected: ‚Äî</div>
                  </div>
                </div>

                <!-- Right column -->
                <div>
                  <div class="regBox">
                    <div class="regHead">
                      <b>My strategies are‚Ä¶</b>
                      <span>short is fine</span>
                    </div>
                    <textarea id="myStrategies" rows="4" placeholder="Example: I found the total goal, added the raised amounts, subtracted, and labeled dollars."></textarea>
                  </div>

                  <div class="regBox">
                    <div class="regHead">
                      <b>Simple reflection</b>
                      <span>pick one</span>
                    </div>
                    <select id="reflectionPick">
                      <option value="">Pick one</option>
                      <option value="I got it">I got it</option>
                      <option value="I kind of got it">I kind of got it</option>
                      <option value="I‚Äôm not
